function e(e){return e&&e.__esModule?e.default:e}var t=e(require("xrm-webapi-client")),n=require("@fluentui/react/lib/ShimmeredDetailsList").ShimmeredDetailsList,i=require("@fluentui/react/lib/Icon").Icon,l=require("@fluentui/font-icons-mdl2").initializeIcons,r=require("@fluentui/react/lib/Stack").Stack,a=require("@fluentui/react/lib/Button").PrimaryButton,o=require("@fluentui/react/lib/Announced").Announced,c=require("@fluentui/react/lib/ChoiceGroup").ChoiceGroup,u=require("@fluentui/react/lib/TextField").TextField,s=require("@fluentui/react/lib/Styling").mergeStyles,m=require("@fluentui/react/lib/MarqueeSelection").MarqueeSelection,d=require("@fluentui/react/lib/DetailsList"),y=d.DetailsListLayoutMode,f=d.Selection,b=require("xrmtoolboxweb-core"),E=b.PCA,h=b.scopes,g=b.prepareWebApiRequest,p=b.EntityFiltersEnum,A=b.useRenderAfterLogin,C=require("@azure/msal-react"),k=C.MsalProvider,q=C.useAccount,S=e(require("react-dom")),v=require("react"),x=e(v),N=v.useCallback,R=v.useEffect,L=v.useState;let F;(F||(F={})).Invoke=e=>{const n=t.Requests.RetrieveAllEntitiesRequest.with({urlParams:{EntityFilters:`Microsoft.Dynamics.CRM.EntityFilters'${e.EntityFilters}'`,RetrieveAsIfPublished:!1},headers:[{key:"Access-Control-Allow-Origin",value:"*.crm.dynamics.com"},{key:"Access-Control-Allow-Credentials",value:"true"},{key:"Access-Control-Allow-Methods",value:"GET, POST, PUT, DELETE, OPTIONS"},{key:"Access-Control-Allow-Headers",value:"Origin, Accept, Content-Type, X-Requested-With, X-CSRF-Token"}]});return t.Execute(n)},l();const I=s({display:"block",marginBottom:"10px"}),M={root:{maxWidth:"300px"}};function P(e){const t=new f({onSelectionChanged:()=>{console.log("onSelectionChanged!")}}),l=(e,t,n)=>x.createElement(r,{horizontal:!0,verticalAlign:"center"},x.createElement("div",null,e[n.fieldName]),x.createElement(i,{iconName:"Copy",styles:{root:{paddingLeft:5}},onClick:()=>{return t=e[n.fieldName],void(navigator.clipboard&&navigator.clipboard.writeText(t).then((()=>console.log(`text '${t}' copied to clipboard`))).catch((e=>console.error("error coping to clipboard",e))));var t}})),a=[{key:"column1",name:"Name",fieldName:"LogicalName",minWidth:100,maxWidth:200,isResizable:!0,onRender:l},{key:"column2",name:"Plural Name",fieldName:"LogicalCollectionName",minWidth:100,maxWidth:200,isResizable:!0,onRender:l},{key:"column3",name:"Primary Name",fieldName:"PrimaryIdAttribute",minWidth:100,maxWidth:200,isResizable:!0,onRender:l}],c=e.metadata??[];return x.createElement("div",null,x.createElement(o,{message:`Number of items: ${c.length}.`}),x.createElement(m,{selection:t},x.createElement(n,{items:c,columns:a,enableShimmer:e.loading,setKey:"set",layoutMode:y.justified,selection:t,selectionPreservedOnEmptyClick:!0,ariaLabelForSelectionColumn:"Toggle selection",ariaLabelForSelectAllCheckbox:"Toggle selection for all items",checkButtonAriaLabel:"select row",onItemInvoked:e=>{alert(`Item invoked: ${e.name}`)}})))}function T(){const[e,t]=L(String(p.Entity)),[n,i]=L({EntityMetadata:[]}),[l,o]=L([]),[s,m]=L(!1),d=N(((e,n)=>{n&&t(n.key)}),[]),y=function(e){const t=Array();for(const[n,i]of Object.entries(e))Number.isNaN(Number(n))&&t.push({text:n+"  ",key:String(i)});return t}(p);return x.createElement(r,null,x.createElement(r,{horizontal:!0},x.createElement(c,{styles:{flexContainer:{display:"flex"}},defaultSelectedKey:p.Entity,options:y,onChange:d,label:"Set Metadata Filter",required:!0}),x.createElement(a,{text:"Run",onClick:()=>{const t=e;m(!0),F.Invoke({EntityFilters:t,RetrieveAsIfPublished:!1}).then((e=>{i(e),o(e.EntityMetadata),m(!1)})).catch((e=>{console.error(e),m(!1)}))},allowDisabledFocus:!0})),x.createElement(u,{className:I,label:"Filter by name:",onChange:(e,t)=>{console.log("onFilter",t),t&&n.EntityMetadata&&o(n.EntityMetadata.filter((e=>0==t.length||e.LogicalName.toLowerCase().indexOf(t)>-1)))},styles:M}),x.createElement(P,{metadata:l,loading:s}))}function w(){const{instance:e,accounts:t,renderAfterLogin:n}=A(),i=q(t[0]||{});return R((()=>{i&&e.acquireTokenSilent({scopes:h,account:i}).then(g).catch((e=>console.error(e)))}),[i?.localAccountId,e]),n((()=>x.createElement("div",null,x.createElement(T,null))))}const W=()=>x.createElement(k,{instance:E},x.createElement(w,null));S.render(x.createElement(W,null),document.getElementById("root"));